<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - Shining Light International School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #27ae60;
            --secondary-color: #2c3e50;
        }
        .sidebar {
            width: 250px;
            background: var(--secondary-color);
            color: white;
            position: fixed;
            height: 100%;
        }
        .top-nav {
            background: white;
            height: 60px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 0 25px;
        }
        .main-content {
            margin-left: 250px;
            min-height: 100vh;
            background: #f5f7fa;
        }
        .welcome-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px;
        }
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        }
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="text-center py-4">
                <h4 class="mb-0">Shining Light</h4>
                <small>Teacher Portal</small>
            </div>
            <div class="px-3">
                <a href="#" class="btn w-100 mb-2 text-start text-white active">
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
                <a href="#" class="btn w-100 mb-2 text-start text-white">
                    <i class="fas fa-users me-2"></i>My Classes
                </a>
                <a href="#gradebook" class="btn w-100 mb-2 text-start text-white" data-bs-toggle="collapse" data-bs-target="#gradebookSubmenu">
                    <i class="fas fa-book me-2"></i>Gradebook
                    <i class="fas fa-chevron-down float-end mt-1 small"></i>
                </a>
                <div class="collapse ps-4" id="gradebookSubmenu">
                    <a href="#upload-scores" class="btn w-100 mb-1 text-start text-white" id="uploadScoresLink">
                        <i class="fas fa-upload me-2"></i>Upload Scores
                    </a>
                    <a href="#manage-grades" class="btn w-100 mb-1 text-start text-white">
                        <i class="fas fa-edit me-2"></i>Manage Grades
                    </a>
                </div>
                <a href="#" class="btn w-100 mb-2 text-start text-white">
                    <i class="fas fa-clipboard-check me-2"></i>Attendance
                </a>
                <a href="#" class="btn w-100 mb-2 text-start text-white">
                    <i class="fas fa-tasks me-2"></i>Assignments
                    <span class="badge bg-danger float-end mt-1">5</span>
                </a>
                <a href="#" class="btn w-100 mb-2 text-start text-white">
                    <i class="fas fa-chart-line me-2"></i>Progress
                </a>
                <a href="#" class="btn w-100 mb-2 text-start text-white">
                    <i class="fas fa-calendar-alt me-2"></i>Schedule
                </a>
                <a href="../login-teacher.html" class="btn w-100 mb-2 text-start text-white position-absolute bottom-0 mb-4">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content w-100">
            <!-- Top Navigation -->
            <nav class="top-nav d-flex align-items-center">
                <button class="btn btn-link text-dark d-md-none" id="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="ms-auto d-flex align-items-center">
                    <div class="dropdown me-3">
                        <button class="btn btn-link text-dark position-relative p-0" data-bs-toggle="dropdown">
                            <i class="fas fa-bell fs-5"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header">Notifications</h6></li>
                            <li><a class="dropdown-item" href="#">New assignment submission</a></li>
                            <li><a class="dropdown-item" href="#">Staff meeting at 3 PM</a></li>
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-link text-dark d-flex align-items-center" data-bs-toggle="dropdown">
                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">JD</div>
                            <span class="ms-2 d-none d-md-inline">Prof. Johnson</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="../login.html"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Dashboard Content -->
            <div class="container-fluid py-4">
                <!-- Welcome Card -->
                <div class="welcome-card">
                    <h2>Welcome back, Professor Johnson</h2>
                    <p class="mb-0">Here's what's happening in your classes today.</p>
                </div>

                <!-- Stats Cards -->
                <div class="row">
                    <div class="col-md-6 col-lg-3">
                        <div class="stats-card">
                            <i class="fas fa-users text-primary"></i>
                            <h3 class="mt-3">4</h3>
                            <p class="text-muted mb-0">Classes</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stats-card">
                            <i class="fas fa-tasks text-warning"></i>
                            <h3 class="mt-3">5</h3>
                            <p class="text-muted mb-0">Assignments to Grade</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stats-card">
                            <i class="fas fa-chalkboard-teacher text-info"></i>
                            <h3 class="mt-3">2</h3>
                            <p class="text-muted mb-0">Classes Today</p>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stats-card">
                            <i class="fas fa-envelope text-success"></i>
                            <h3 class="mt-3">3</h3>
                            <p class="text-muted mb-0">New Messages</p>
                        </div>
                    </div>
                </div>

                <!-- Upload Scores Section -->
                <div class="card mb-4" id="upload-scores" style="display: none;">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="fas fa-upload me-2"></i>Upload Student Scores</h4>
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label class="form-label">Class</label>
                                <select class="form-select" id="selectClass">
                                    <option selected disabled>Select Class</option>
                                    <option>SS 1A</option>
                                    <option>SS 1B</option>
                                    <option>SS 2A</option>
                                    <option>SS 2B</option>
                                    <option>SS 3A</option>
                                    <option>SS 3B</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Subject</label>
                                <select class="form-select" id="selectSubject">
                                    <option selected disabled>Select Subject</option>
                                    <option>Mathematics</option>
                                    <option>English Language</option>
                                    <option>Physics</option>
                                    <option>Chemistry</option>
                                    <option>Biology</option>
                                    <option>Economics</option>
                                    <option>Geography</option>
                                    <option>Further Mathematics</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Term</label>
                                <select class="form-select" id="selectTerm">
                                    <option selected disabled>Select Term</option>
                                    <option>1st Term 2023/2024</option>
                                    <option>2nd Term 2023/2024</option>
                                    <option>3rd Term 2023/2024</option>
                                </select>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered" id="scoresTable">
                                <thead class="table-light">
                                    <tr>
                                        <th rowspan="2">#</th>
                                        <th rowspan="2">Student Name</th>
                                        <th rowspan="2">Admission No.</th>
                                        <th colspan="4" class="text-center">Scores</th>
                                        <th rowspan="2">Total (100)</th>
                                        <th rowspan="2">Grade</th>
                                        <th rowspan="2">Remark</th>
                                        <th rowspan="2">Actions</th>
                                    </tr>
                                    <tr>
                                        <th>1st CA (20)</th>
                                        <th>2nd CA (20)</th>
                                        <th>Exam (60)</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3">
                            <button class="btn btn-primary" id="addStudentRow">
                                <i class="fas fa-plus me-1"></i> Add Student
                            </button>
                            <button class="btn btn-success float-end" id="submitScores">
                                <i class="fas fa-save me-1"></i> Save All Scores
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-calendar-day me-2"></i>Today's Schedule</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <div>
                                                <h6 class="mb-1">Mathematics - Grade 8A</h6>
                                                <p class="mb-1">Algebra: Quadratic Equations</p>
                                                <small class="text-muted">Room 201</small>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge bg-primary">9:00 AM - 10:30 AM</span>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-outline-primary">Take Attendance</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <div>
                                                <h6 class="mb-1">Mathematics - Grade 7B</h6>
                                                <p class="mb-1">Geometry: Angles and Triangles</p>
                                                <small class="text-muted">Room 105</small>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge bg-primary">11:00 AM - 12:30 PM</span>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-outline-primary">Take Attendance</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mt-4 mt-lg-0">
                        <!-- Pending Assignments -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Pending Grading</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Algebra Test</h6>
                                            <small class="text-muted">Grade 8A</small>
                                        </div>
                                        <div class="progress mt-2" style="height: 8px;">
                                            <div class="progress-bar bg-warning" style="width: 65%"></div>
                                        </div>
                                        <small class="text-muted">13/20 graded</small>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Geometry Homework</h6>
                                            <small class="text-muted">Grade 7B</small>
                                        </div>
                                        <div class="progress mt-2" style="height: 8px;">
                                            <div class="progress-bar bg-danger" style="width: 30%"></div>
                                        </div>
                                        <small class="text-muted">6/20 graded</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary w-100 mb-2">
                                    <i class="fas fa-plus me-2"></i>New Assignment
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-2">
                                    <i class="fas fa-clipboard-list me-2"></i>Take Attendance
                                </button>
                                <button class="btn btn-outline-primary w-100">
                                    <i class="fas fa-chart-bar me-2"></i>View Reports
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Toggle sidebar on mobile
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('show');
        });

        // Show upload scores section when link is clicked
        document.getElementById('uploadScoresLink').addEventListener('click', function(e) {
            e.preventDefault();
            // Hide main content sections
            document.querySelectorAll('.welcome-card, .row.mt-4').forEach(el => {
                el.style.display = 'none';
            });
            // Show upload scores section
            const uploadSection = document.getElementById('upload-scores');
            uploadSection.style.display = 'block';
            // Scroll to the upload section
            uploadSection.scrollIntoView({ behavior: 'smooth' });
            document.title = 'Upload Scores | Teacher Dashboard';
        });

        // Show main content when clicking the dashboard link
        document.querySelector('a[href="#"]').addEventListener('click', function(e) {
            if (this.textContent.includes('Dashboard')) {
                e.preventDefault();
                document.querySelectorAll('.card, .welcome-card, .row').forEach(el => {
                    el.style.display = '';
                });
                document.getElementById('upload-scores').style.display = 'none';
                document.title = 'Teacher Dashboard';
            }
        });

        // Add student row to scores table
        let studentCounter = 1;
        document.getElementById('addStudentRow').addEventListener('click', function() {
            const tbody = document.querySelector('#scoresTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${studentCounter}</td>
                <td><input type="text" class="form-control form-control-sm student-name" placeholder="Student Name" required></td>
                <td><input type="text" class="form-control form-control-sm admission-no" placeholder="Admission No." required></td>
                <td><input type="number" class="form-control form-control-sm ca1-score" min="0" max="20" value="0"></td>
                <td><input type="number" class="form-control form-control-sm ca2-score" min="0" max="20" value="0"></td>
                <td><input type="number" class="form-control form-control-sm exam-score" min="0" max="60" value="0"></td>
                <td class="subject-total">0</td>
                <td class="total-score">0</td>
                <td class="grade">
                    <select class="form-select form-select-sm grade-select" required>
                        <option value="">Select Grade</option>
                        <option value="A1">A1 (75-100)</option>
                        <option value="B2">B2 (70-74)</option>
                        <option value="B3">B3 (65-69)</option>
                        <option value="C4">C4 (60-64)</option>
                        <option value="C5">C5 (55-59)</option>
                        <option value="C6">C6 (50-54)</option>
                        <option value="D7">D7 (45-49)</option>
                        <option value="E8">E8 (40-44)</option>
                        <option value="F9">F9 (0-39)</option>
                    </select>
                </td>
                <td class="remark">-</td>
                <td>
                    <button class="btn btn-sm btn-danger remove-row" title="Remove student">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
            studentCounter++;

            // Add event listeners to new row
            addScoreEventListeners(row);
        });

        // Function to add event listeners to score inputs
        function addScoreEventListeners(row) {
            const ca1Input = row.querySelector('.ca1-score');
            const ca2Input = row.querySelector('.ca2-score');
            const examInput = row.querySelector('.exam-score');
            const subjectTotalCell = row.querySelector('.subject-total');
            const totalCell = row.querySelector('.total-score');
            const gradeSelect = row.querySelector('.grade-select');
            const remarkCell = row.querySelector('.remark');

            function updateScores() {
                const ca1 = parseInt(ca1Input.value) || 0;
                const ca2 = parseInt(ca2Input.value) || 0;
                const exam = parseInt(examInput.value) || 0;
                
                // Calculate subject total (CA1 + CA2 + Exam)
                const subjectTotal = ca1 + ca2 + exam;
                subjectTotalCell.textContent = subjectTotal;
                
                // Calculate percentage (out of 100)
                const percentage = Math.round((subjectTotal / 100) * 100);
                totalCell.textContent = percentage;
                
                // Auto-update grade based on percentage if not manually set
                if (!gradeSelect.dataset.manual) {
                    if (percentage >= 75) gradeSelect.value = 'A1';
                    else if (percentage >= 70) gradeSelect.value = 'B2';
                    else if (percentage >= 65) gradeSelect.value = 'B3';
                    else if (percentage >= 60) gradeSelect.value = 'C4';
                    else if (percentage >= 55) gradeSelect.value = 'C5';
                    else if (percentage >= 50) gradeSelect.value = 'C6';
                    else if (percentage >= 45) gradeSelect.value = 'D7';
                    else if (percentage >= 40) gradeSelect.value = 'E8';
                    else gradeSelect.value = 'F9';
                }
                
                // Update remark based on grade
                updateRemark(gradeSelect.value);
                
                // Update row color based on grade
                updateRowColor(row, gradeSelect.value);
            }
            
            function updateRemark(grade) {
                const remarks = {
                    'A1': 'Excellent',
                    'B2': 'Very Good',
                    'B3': 'Good',
                    'C4': 'Credit',
                    'C5': 'Credit',
                    'C6': 'Credit',
                    'D7': 'Pass',
                    'E8': 'Pass',
                    'F9': 'Fail'
                };
                remarkCell.textContent = remarks[grade] || '-';
            }
            
            function updateRowColor(row, grade) {
                const colors = {
                    'A1': 'table-success',
                    'B2': 'table-info',
                    'B3': 'table-info',
                    'C4': 'table-warning',
                    'C5': 'table-warning',
                    'C6': 'table-warning',
                    'D7': 'table-danger',
                    'E8': 'table-danger',
                    'F9': 'table-danger'
                };
                
                // Remove all color classes
                ['table-success', 'table-info', 'table-warning', 'table-danger'].forEach(cls => {
                    row.classList.remove(cls);
                });
                
                // Add the appropriate color class
                if (colors[grade]) {
                    row.classList.add(colors[grade]);
                }
            }
                
                // Update row color based on grade
                const gradeColors = {
                    'A': '#d4edda',
                    'B': '#d1ecf1',
                    'C': '#fff3cd',
                    'D': '#f8d7da',
                    'E': '#f8d7da',
                    'F': '#f8d7da'
                };
                row.style.backgroundColor = gradeColors[grade] || '#ffffff';
            }

            // Add event listeners to all score inputs
            [ca1Input, ca2Input, examInput].forEach(input => {
                input.addEventListener('input', updateScores);
            });
            
            // Add event listener for manual grade selection
            gradeSelect.addEventListener('change', function() {
                this.dataset.manual = 'true';
                updateRemark(this.value);
                updateRowColor(row, this.value);
            });

            // Add remove row functionality
            const removeBtn = row.querySelector('.remove-row');
            removeBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to remove this student?')) {
                    row.remove();
                    updateRowNumbers();
                }
            });
            
            // Initialize row
            updateScores();
        
        // Update row numbers after removal
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#scoresTable tbody tr');
            rows.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
            studentCounter = rows.length + 1;
        }

        // Submit scores
        document.getElementById('submitScores').addEventListener('click', function() {
            const classSelected = document.getElementById('selectClass').value;
            const subject = document.getElementById('selectSubject').value;
            const term = document.getElementById('selectTerm').value;
            
            if (!classSelected || !subject || !term) {
                Swal.fire({
                    icon: 'error',
                    title: 'Incomplete Information',
                    text: 'Please select class, subject, and term before submitting.',
                    confirmButtonColor: '#3085d6',
                });
                return;
            }

            const rows = document.querySelectorAll('#scoresTable tbody tr');
            if (rows.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'No Data',
                    text: 'Please add at least one student record.',
                    confirmButtonColor: '#3085d6',
                });
                return;
            }

            // Collect all scores data
            const scoresData = [];
            rows.forEach(row => {
                const cells = row.cells;
                scoresData.push({
                    name: row.querySelector('.student-name').value,
                    admissionNo: row.querySelector('.admission-no').value,
                    ca1: row.querySelector('.ca1-score').value,
                    ca2: row.querySelector('.ca2-score').value,
                    exam: row.querySelector('.exam-score').value,
                    subjectTotal: row.querySelector('.subject-total').textContent,
                    percentage: row.querySelector('.total-score').textContent,
                    grade: row.querySelector('.grade-select').value,
                    remark: row.querySelector('.remark').textContent
                });
            });

            // In a real application, you would send this data to a server
            console.log({
                class: classSelected,
                subject: subject,
                term: term,
                scores: scoresData
            });

            // Show success message
            Swal.fire({
                icon: 'success',
                title: 'Scores Saved!',
                text: `Scores for ${subject} (${classSelected}) have been saved successfully.`,
                confirmButtonColor: '#3085d6',
            }).then(() => {
                // Reset form
                document.getElementById('scoresTable').querySelector('tbody').innerHTML = '';
                studentCounter = 1;
            });
        });
    </script>
</body>
</html>
